<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz | Radar do surf</title>
    <link rel="stylesheet" href="./css/quiz.css">
    <link rel="icon" href="../public/assets/imgs/logo.png">
</head>

<body>
    <div class="imagem">
        <a href="../public/index.html">
            <img src="./assets/imgs/logo.png" alt="">
        </a>
    </div>
    <div id="container">
        <button id="btIniciar" onclick="iniciarQuiz()">Iniciar Quiz</button>
        <div id="quiz" style="display: none;">
            <h2>Quiz Surf</h2>
            <div id="questao"></div>
            <div id="pergunta"></div>
            <div id="opcoes"></div>
            <div id="botoesNavegacao">
                <button id="btVoltar" onclick="voltar()">Voltar</button>
                <button id="btAvancar" onclick="avancar()">Avançar</button>
            </div>
        </div>

        <div id="resultado" style="display: none;"></div>
    </div>


    <script>

        const perguntas = [
            {
                pergunta: "1. Quando você chega na praia, qual é a primeira coisa que faz?",
                opcoes: [
                    "Corro direto pro mar, não posso perder tempo!",
                    "Fico observando as ondas antes de entrar.",
                    "Dou uma volta, converso com a galera e depois penso em surfar.",
                    "Prefiro curtir o visual e relaxar na areia.",
                    "Ajusto minha prancha e preparo tudo com calma antes de entrar."

                ],
                pontos: ["gun", "fish", "longboard", "funboard", "shortboard"]
            },
            {
                pergunta: "2. Como você descreveria seu estilo de surf?",
                opcoes: [
                    "Radical e cheio de manobras.",
                    "Suave e fluido.",
                    "Equilibrado, gosto de um pouco de tudo.",
                    "Tranquilo, só pelo prazer.",
                    "Técnico e focado em evoluir detalhes"
                ],
                pontos: ["gun", "longboard", "fish", "funboard", "shortboard"]
            },
            {
                pergunta: "3. Qual o tamanho de onda ideal pra você?",
                opcoes: [
                    "Grandes e desafiadoras.",
                    "Médias com boa formação.",
                    "Pequenas, só pra brincar.",
                    "Tanto faz! Quero me divertir.",
                    "Ondas longas para aproveitar bem a linha"
                ],
                pontos: ["gun", "fish", "longboard", "funboard", "shortboard"]
            },
            {
                pergunta: "4. O que mais te atrai no surf?",
                opcoes: [
                    "A adrenalina e os desafios.",
                    "A conexão com a natureza.",
                    "O equilíbrio e a técnica.",
                    " A paz e a sensação de liberdade.",
                    "A evolução constante e o aprendizado"
                ],
                pontos: ["gun", "longboard", "fish", "funboard", "shortboard"]
            },
            {

                pergunta: "5. Se você tivesse que escolher um destino de surf, qual seria?",
                opcoes: [
                    "Nazaré (Portugal) – ondas gigantes e poderosas.",
                    "Bali (Indonésia) – perfeição e boas vibrações.",
                    "Saquarema (Brasil) – boas ondas e clima local.",
                    "Fernando de Noronha – natureza e tranquilidade.",
                    "Costa Rica - constância de onda e clima relax"
                ],
                pontos: ["gun", "shortboard", "fish", "longboard", "funboard"]
            },
            {

                pergunta: "6. Como você descreveria sua personalidade no surf?",
                opcoes: [
                    "Intenso(a) e competitivo(a).",
                    "Calmo(a) e observador(a).",
                    "Flexível e adaptável.",
                    "Tranquilo(a) e sonhador(a).",
                    "Determinado e focado em melhorar"
                ],
                pontos: ["gun", "longboard", "fish", "funboard", "shortboard"]
            },
            {
                pergunta: "7. Se o mar estivesse totalmente diferente do previsto, o que você faria?",
                opcoes: [
                    "Espero melhorar, paciência é tudo.",
                    "Entro mesmo assim, quero o desafio!",
                    "Tento aproveitar de outro jeito.",
                    "Fico na areia, curtindo o som das ondas.",
                    "Procuro outro pico com condições melhores"
                ],
                pontos: ["longboard", "gun", "fish", "funboard", "shortboard"]
            },
            {

                pergunta: "8. Qual frase combina mais com você?",
                opcoes: [
                    "Quero aproveitar cada onda com calma.",
                    "Quero algo versátil para qualquer condição.",
                    "Quero performance e adrenalina.",
                    "Quero encarar ondas grandes e sentir a potência do mar.",
                    "Quero melhorar minha linha e meu estilo em cada sessão"
                ],
                pontos: ["longboard", "fish", "funboard", "gun", "shortboard"]
            },
            {

                pergunta: "9. Quando você entra na água, seu foco principal é...",
                opcoes: [
                    "Relaxar",
                    "Me divertir",
                    "Evoluir tecnicamente",
                    "Sentir adrenalina",
                    "Me conectar com o mar e limpar a mente"
                ],
                pontos: ["longboard", "funboard", "shortboard", "gun", "fish"]
            }
        ];

        const pranchas = {
            longboard: {
                nome: "Longboard ",
                img: "./assets/imgs/longboard.jpg",
                mensagem: "Você gosta de fluidez, estilo e ondas longas!"
            },
            shortboard: {
                nome: "Shortboard ",
                img: "./assets/imgs/short.webp",
                mensagem: "Rápido, radical e sempre buscando evolução!"
            },
            fish: {
                nome: "Fish ",
                img: "./assets/imgs/fish.jpg",
                mensagem: "Você gosta de diversão, velocidade e curvas suaves!"
            },
            funboard: {
                nome: "Funboard ",
                img: "./assets/imgs/fun.webp",
                mensagem: "Equilíbrio perfeito entre estabilidade e diversão!"
            },
            gun: {
                nome: "Gun ",
                img: "./assets/imgs/gun2.webp",
                mensagem: "Você nasceu para adrenalina e ondas grandes!"
            }
        };

        const pontuacao = { longboard: 0, shortboard: 0, fish: 0, funboard: 0, gun: 0 };

        let perguntaAtual = 0;
        let respostasUsuario = {};

        const quizPai = document.getElementById("quiz");
        const infoQuestao = document.getElementById("questao");
        const textoPergunta = document.getElementById("pergunta");
        const containerOpcoes = document.getElementById("opcoes");
        const botaoVoltar = document.getElementById("btVoltar");
        const botaoAvancar = document.getElementById("btAvancar");
        const containerResultado = document.getElementById("resultado");
        const botaoIniciar = document.getElementById("btIniciar");

        function iniciarQuiz() {
            botaoIniciar.style.display = "none";
            quizPai.style.display = "block";
            carregarPergunta();
        }

        function carregarPergunta() {
            const q = perguntas[perguntaAtual];

            infoQuestao.textContent = `Pergunta ${perguntaAtual + 1} de ${perguntas.length}`;
            textoPergunta.textContent = q.pergunta;

            containerOpcoes.innerHTML = "";

            q.opcoes.forEach((opcao, index) => {
                const div = document.createElement("div");
                div.className = "opcao";

                const input = document.createElement("input");
                input.type = "radio";
                input.name = "opcao";
                input.value = index;
                input.checked = respostasUsuario[perguntaAtual] == index;

                const label = document.createElement("label");
                label.textContent = opcao;

                div.appendChild(input);
                div.appendChild(label);
                containerOpcoes.appendChild(div);
            });

            botaoVoltar.style.display = perguntaAtual === 0 ? "none" : "inline-block";
            botaoAvancar.textContent = (perguntaAtual === perguntas.length - 1) ? "Finalizar" : "Avançar";
        }


        function avancar() {
            const selecionada = document.querySelector("input[name='opcao']:checked");

            if (!selecionada) {
                alert("Selecione uma opção!");
                return;

            }

            respostasUsuario[perguntaAtual] = Number(selecionada.value);

            if (perguntaAtual < perguntas.length - 1) {
                perguntaAtual++;
                carregarPergunta();
            } else {
                calcularResultado();
            }
        }

        function voltar() {
            if (perguntaAtual > 0) {
                perguntaAtual--;
                carregarPergunta();
            }
        }

        function calcularResultado() {
            for (let p in pontuacao) pontuacao[p] = 0;

            perguntas.forEach((p, index) => {
                const opcaoEscolhida = respostasUsuario[index];
                const tipoPrancha = p.pontos[opcaoEscolhida];
                pontuacao[tipoPrancha]++;
            });

            fetch("/usuarios/pergunta", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    longboardServer: pontuacao.longboard,
                    funboardServer: pontuacao.funboard,
                    shortboardServer: pontuacao.shortboard,
                    fishboardServer: pontuacao.fish,
                    gunServer: pontuacao.gun,
                    idServer: sessionStorage.ID_USUARIO
                    //idEmpresaVincularServer: idEmpresaVincular
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {

                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });

            let resultadoFinal = Object.keys(pontuacao).reduce((a, b) =>
                pontuacao[a] > pontuacao[b] ? a : b
            );

            mostrarResultado(resultadoFinal);
        }

        function mostrarResultado(prancha) {
            quizPai.style.display = "none";
            containerResultado.style.display = "block";

            containerResultado.innerHTML = `
                <h2>${pranchas[prancha].nome}</h2>
                <img src="${pranchas[prancha].img}" width="300">
                <p>${pranchas[prancha].mensagem}</p>
                <button onclick="location.reload()" style="padding: 10px 20px; background:#0044aa; border: none; color:white; border-radius:8px;">Recomeçar</button>
                <a href="./dashboard/dashboard.html" style="padding: 10px 10px; background:#0044aa; border: none; color: white; border-radius:8px;"> Ver dashboard</a>`;
        }



    </script>

</body>

</html>